"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[469],{3469:(e,t,a)=>{a.d(t,{RequestForm:()=>U});var r=a(5155),s=a(2115),n=a(2853),l=a(9562),i=a(2641),o=a(1221),d=a(2619),c=a(2359),u=a(8369),m=a(1067),p=a(5635),x=a(690),h=a(4474),g=a(422),j=a(9770),b=a(2544),A=a(4879);let y=A.Ik({startDate:A.Yj().min(1,"Start date is required"),endDate:A.Yj().min(1,"End date is required"),preset:A.Yj().optional()}).refine(e=>!e.startDate||!e.endDate||new Date(e.startDate)<=new Date(e.endDate),{message:"Start date must be before or equal to end date",path:["startDate"]}),v=A.Ik({title:A.Yj().min(5,"Title must be at least 5 characters"),department:A.Yj().min(1,"Please select a department"),dateRange:y,description:A.Yj().min(20,"Description must be at least 20 characters"),contactEmail:A.Yj().email("Please provide a valid email"),attachments:A.YO(A.bz()).optional()});var D=a(6942),f=a(2005),S=a(9767),w=a(4578),R=a(1983),k=a(4054),I=a(6053),C=a(2608),q=a(7095),F=a(9200),E=a(8831),P=a(8116);let T=(0,P.Ay)(n.A)(e=>{let{theme:t}=e;return{border:"2px dashed ".concat(t.palette.divider),borderRadius:t.shape.borderRadius,padding:t.spacing(4),textAlign:"center",cursor:"pointer","&:hover":{backgroundColor:t.palette.action.hover}}}),W=(0,P.Ay)(n.A)(e=>{let{theme:t}=e;return{marginTop:t.spacing(2)}}),B=e=>{if(0===e)return"0 Bytes";let t=Math.floor(Math.log(e)/Math.log(1024));return"".concat(parseFloat((e/Math.pow(1024,t)).toFixed(2))," ").concat(["Bytes","KB","MB","GB"][t])},Y=e=>{let{onFilesSelected:t,maxFiles:a=5,maxSize:l=0xa00000,acceptedFileTypes:i=["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","text/plain","image/jpeg","image/png"],isLoading:o=!1,error:d=""}=e,[c,u]=(0,s.useState)([]),m=(0,s.useCallback)((e,a)=>{let r=[...c,...e];u(r),t(r)},[t,c]),h=(0,s.useCallback)(e=>{let a=c.filter((t,a)=>a!==e);u(a),t(a)},[c,t]),{getRootProps:g,getInputProps:b,isDragActive:A,fileRejections:y}=(0,k.VB)({onDrop:m,maxFiles:a,maxSize:l,accept:i.reduce((e,t)=>({...e,[t]:[]}),{})});return(0,r.jsxs)(n.A,{children:[(0,r.jsxs)(T,{...g(),sx:{bgcolor:A?"action.hover":"background.paper"},children:[(0,r.jsx)("input",{...b()}),(0,r.jsx)(I.A,{sx:{fontSize:40,color:"primary.main",mb:2}}),(0,r.jsx)(p.A,{variant:"body1",gutterBottom:!0,children:A?"Drop the files here":"Drag and drop files here, or click to select files"}),(0,r.jsx)(p.A,{variant:"caption",color:"textSecondary",children:"Accepted files: PDF, Word documents, text files, images (JPG, PNG)"}),(0,r.jsxs)(p.A,{variant:"caption",display:"block",color:"textSecondary",children:["Maximum size: ",B(l)]}),(0,r.jsx)(x.A,{variant:"contained",sx:{mt:2},disabled:o,children:"Select Files"})]}),o&&(0,r.jsx)(n.A,{sx:{mt:2},children:(0,r.jsx)(f.A,{})}),d&&(0,r.jsx)(p.A,{color:"error",variant:"body2",sx:{mt:1},children:d}),y.length>0&&(0,r.jsx)(n.A,{sx:{mt:2},children:y.map((e,t)=>{let{file:a,errors:s}=e;return(0,r.jsxs)(j.A,{severity:"error",sx:{mb:1},children:[a.name,": ",s.map(e=>e.message).join(", ")]},"".concat(a.name,"-").concat(t))})}),c.length>0&&(0,r.jsxs)(W,{children:[(0,r.jsxs)(p.A,{variant:"subtitle2",gutterBottom:!0,children:["Selected Files (",c.length,"/",a,"):"]}),c.map((e,t)=>{let a=(e=>e.type.startsWith("image/")?URL.createObjectURL(e):null)(e);return(0,r.jsx)(S.A,{sx:{mb:1},children:(0,r.jsx)(w.A,{sx:{p:2,"&:last-child":{pb:2}},children:(0,r.jsxs)(n.A,{sx:{display:"flex",alignItems:"center",gap:2},children:[a?(0,r.jsx)(n.A,{component:"img",src:a,alt:e.name,sx:{width:40,height:40,objectFit:"cover",borderRadius:1}}):(0,r.jsx)(n.A,{sx:{display:"flex",alignItems:"center",justifyContent:"center",width:40,height:40},children:(e=>e.type.startsWith("image/")?(0,r.jsx)(F.A,{color:"primary"}):"application/pdf"===e.type?(0,r.jsx)(E.A,{color:"error"}):(0,r.jsx)(q.A,{color:"action"}))(e)}),(0,r.jsxs)(n.A,{sx:{flexGrow:1,minWidth:0},children:[(0,r.jsx)(p.A,{variant:"body2",noWrap:!0,title:e.name,children:e.name}),(0,r.jsx)(p.A,{variant:"caption",color:"textSecondary",children:B(e.size)})]}),(0,r.jsx)(R.A,{size:"small",onClick:()=>h(t),disabled:o,"aria-label":"Remove ".concat(e.name),children:(0,r.jsx)(C.A,{})})]})})},"".concat(e.name,"-").concat(t))})]})]})};var L=a(3077);let z=[{value:"last-7-days",label:"Last 7 days"},{value:"last-30-days",label:"Last 30 days"},{value:"last-90-days",label:"Last 90 days"},{value:"last-year",label:"Last year"},{value:"custom",label:"Custom range"}],M=e=>{let{value:t={startDate:"",endDate:"",preset:""},onChange:a,error:m="",disabled:x=!1,label:h="Date Range"}=e,[g,j]=(0,s.useState)(t.preset||""),[b,A]=(0,s.useState)(t.startDate||""),[y,v]=(0,s.useState)(t.endDate||""),D="custom"===g;return(0,r.jsxs)(n.A,{children:[(0,r.jsx)(p.A,{variant:"subtitle2",gutterBottom:!0,children:h}),(0,r.jsxs)(i.A,{fullWidth:!0,error:!!m,sx:{mb:2},children:[(0,r.jsx)(o.A,{children:"Time Period"}),(0,r.jsx)(d.A,{value:g,label:"Time Period",onChange:e=>{let t=e.target.value;if(j(t),"custom"===t)a({startDate:b,endDate:y,preset:t});else{let e=(e=>{let t=new Date,a=e=>e.toISOString().split("T")[0];switch(e){case"last-7-days":return{startDate:a(new Date(t.getTime()-6048e5)),endDate:a(t)};case"last-30-days":return{startDate:a(new Date(t.getTime()-2592e6)),endDate:a(t)};case"last-90-days":return{startDate:a(new Date(t.getTime()-7776e6)),endDate:a(t)};case"last-year":return{startDate:a(new Date(t.getTime()-31536e6)),endDate:a(t)};default:return{}}})(t),r={startDate:e.startDate||"",endDate:e.endDate||"",preset:t};A(r.startDate),v(r.endDate),a(r)}},disabled:x,"data-testid":"date-range-preset",children:z.map(e=>(0,r.jsx)(c.A,{value:e.value,children:e.label},e.value))}),m&&(0,r.jsx)(u.A,{children:m})]}),D&&(0,r.jsxs)(L.Ay,{container:!0,spacing:2,children:[(0,r.jsx)(L.Ay,{item:!0,xs:12,sm:6,children:(0,r.jsx)(l.A,{label:"Start Date",type:"date",value:b,onChange:e=>{let t=e.target.value;A(t),a({startDate:t,endDate:y,preset:g})},fullWidth:!0,disabled:x,InputLabelProps:{shrink:!0},inputProps:{max:y||void 0},"data-testid":"start-date-input"})}),(0,r.jsx)(L.Ay,{item:!0,xs:12,sm:6,children:(0,r.jsx)(l.A,{label:"End Date",type:"date",value:y,onChange:e=>{let t=e.target.value;v(t),a({startDate:b,endDate:t,preset:g})},fullWidth:!0,disabled:x,InputLabelProps:{shrink:!0},inputProps:{min:b||void 0,max:new Date().toISOString().split("T")[0]},"data-testid":"end-date-input"})})]}),!D&&(b||y)&&(0,r.jsx)(n.A,{sx:{mt:1,p:2,bgcolor:"grey.50",borderRadius:1},children:(0,r.jsxs)(p.A,{variant:"body2",color:"textSecondary",children:["Selected range: ",b," to ",y]})})]})};var G=a(8667);let O=[{id:"police",name:"Police Department"},{id:"fire",name:"Fire Department"},{id:"clerk",name:"City Clerk"},{id:"finance",name:"Finance Department"},{id:"other",name:"Other"}],U=()=>{var e,t,a;let[A,y]=(0,s.useState)(!1),[f,S]=(0,s.useState)(null),[w,R]=(0,s.useState)(!1),[k,I]=(0,s.useState)(null),[C,q]=(0,s.useState)([]),[F,E]=(0,s.useState)(""),{control:P,handleSubmit:T,formState:{errors:W},setValue:B,watch:L}=(0,b.mN)({resolver:(0,D.u)(v),defaultValues:{title:"",department:"",description:"",dateRange:{startDate:"",endDate:"",preset:""},contactEmail:""}}),z=L("dateRange"),U=async e=>{y(!0),S(null);try{let t={...e,files:C},a=await (0,G.Fc)(t);console.log("Request saved:",a);let r="/confirmation?trackingId=".concat(encodeURIComponent(a.trackingId));window.location.href=r}catch(e){S(e instanceof Error?e.message:"An error occurred while submitting your request"),y(!1)}};return(0,r.jsxs)(n.A,{component:"form",onSubmit:T(U),noValidate:!0,children:[(0,r.jsxs)(n.A,{sx:{display:"flex",flexDirection:"column",gap:3},children:[(0,r.jsx)(n.A,{children:(0,r.jsx)(b.xI,{name:"title",control:P,render:e=>{var t;let{field:a}=e;return(0,r.jsx)(l.A,{...a,label:"Request Title",fullWidth:!0,error:!!W.title,helperText:null==(t=W.title)?void 0:t.message,disabled:A})}})}),(0,r.jsx)(n.A,{sx:{display:"flex",gap:3,flexDirection:{xs:"column",md:"row"}},children:(0,r.jsx)(n.A,{sx:{flex:1},children:(0,r.jsx)(b.xI,{name:"department",control:P,render:e=>{var t;let{field:a}=e;return(0,r.jsxs)(i.A,{fullWidth:!0,error:!!W.department,children:[(0,r.jsx)(o.A,{children:"Department"}),(0,r.jsx)(d.A,{...a,label:"Department",disabled:A,"data-testid":"department-select",children:O.map(e=>(0,r.jsx)(c.A,{value:e.id,children:e.name},e.id))}),(0,r.jsx)(u.A,{children:null==(t=W.department)?void 0:t.message})]})}})})}),(0,r.jsx)(n.A,{children:(0,r.jsx)(M,{value:z,onChange:e=>{B("dateRange",e,{shouldValidate:!0})},error:(null==(e=W.dateRange)?void 0:e.message)||(null==(a=W.dateRange)||null==(t=a.startDate)?void 0:t.message),disabled:A,label:"Records Date Range"})}),(0,r.jsx)(n.A,{children:(0,r.jsx)(b.xI,{name:"description",control:P,render:e=>{var t;let{field:a}=e;return(0,r.jsx)(l.A,{...a,label:"Request Description",multiline:!0,rows:4,fullWidth:!0,error:!!W.description,helperText:null==(t=W.description)?void 0:t.message,disabled:A})}})}),(0,r.jsx)(n.A,{children:(0,r.jsx)(b.xI,{name:"contactEmail",control:P,render:e=>{var t;let{field:a}=e;return(0,r.jsx)(l.A,{...a,label:"Contact Email",type:"email",fullWidth:!0,error:!!W.contactEmail,helperText:null==(t=W.contactEmail)?void 0:t.message,disabled:A})}})}),(0,r.jsxs)(n.A,{children:[(0,r.jsx)(m.A,{sx:{my:2}}),(0,r.jsx)(p.A,{variant:"h6",gutterBottom:!0,children:"Supporting Documents (Optional)"}),(0,r.jsx)(p.A,{variant:"body2",color:"textSecondary",sx:{mb:2},children:"Upload any documents that help clarify or support your records request."}),(0,r.jsx)(Y,{onFilesSelected:e=>{q(e),E("")},maxFiles:5,maxSize:0xa00000,acceptedFileTypes:["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","text/plain","image/jpeg","image/png"],isLoading:A,error:F})]}),(0,r.jsx)(n.A,{children:(0,r.jsx)(x.A,{type:"submit",variant:"contained",color:"primary",size:"large",fullWidth:!0,disabled:A,startIcon:A?(0,r.jsx)(h.A,{size:20}):null,children:A?"Submitting...":"Submit Request"})})]}),(0,r.jsx)(g.A,{open:!!f||w,autoHideDuration:w?null:6e3,onClose:()=>{S(null),R(!1),I(null)},children:(0,r.jsx)(j.A,{severity:f?"error":"success",variant:"filled",onClose:()=>{S(null),R(!1),I(null)},children:f||(k?"Request submitted successfully! Your tracking ID is: ".concat(k,". Please save this ID to track your request status."):"Request submitted successfully!")})})]})}},8667:(e,t,a)=>{let r,s;a.d(t,{hY:()=>u,Fc:()=>c});var n=a(9708),l=a(2078);let i={apiKey:"demo-key",authDomain:"demo-project.firebaseapp.com",projectId:"public-records-demo",storageBucket:"public-records-demo.appspot.com",messagingSenderId:"123456789",appId:"1:123456789:web:demo123"},{app:o,db:d}=(()=>{if(r=(0,l.Dk)().length?(0,l.Dk)()[0]:(0,l.Wp)(i),!s){s=(0,n.aU)(r);let e="localhost:8080";try{let[t,a]=e.split(":");(0,n.vN)(s,t,parseInt(a)),console.log("Connected to Firestore emulator at",e)}catch(e){console.warn("Failed to connect to Firestore emulator:",e)}}return{app:r,db:s}})(),c=async e=>{try{var t;let a=(()=>{let e=Date.now().toString().slice(-6),t=Math.random().toString(36).substring(2,6).toUpperCase();return"PR-".concat(e,"-").concat(t)})(),r=n.Dc.now(),s={trackingId:a,title:e.title,department:e.department,description:e.description,dateRange:e.dateRange,contactEmail:e.contactEmail,status:"submitted",submittedAt:r,updatedAt:r,attachmentCount:(null==(t=e.files)?void 0:t.length)||0,attachmentPaths:[]},l=await (0,n.gS)((0,n.rJ)(d,"requests"),s);return console.log("Request saved with ID:",l.id),{id:l.id,trackingId:a}}catch(e){throw console.error("Error saving request:",e),Error("Failed to save request. Please try again.")}},u=async e=>{try{let t=(0,n.P)((0,n.rJ)(d,"requests"),(0,n._M)("trackingId","==",e)),a=await (0,n.GG)(t);if(a.empty)return null;let r=a.docs[0];return{id:r.id,...r.data()}}catch(e){throw console.error("Error fetching request by tracking ID:",e),Error("Failed to fetch request")}}}}]);